web:
  image: dockercloud/hello-world
  environment:
    - VIRTUAL_HOST=https://www.dockermeetup.live,http://www.dockermeetup.live
  target_num_containers: 10
lb:
  image: dockercloud/haproxy:1.6.5
  roles:
    - global
  links:
    - web
    - cert-service
  ports:
    - 443:443
    - 80:80
  environment:
    - DEFAULT_SSL_CERT=-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCcEEyRG+9LdB0A\nM6dL+46sPxd0E1g8ws95VAF+KASzPgbXnvLoimMDHCGR1jJ+zXwHnpfbKw5LbQ2c\njdYI+RmMZxGJA057CXj6zM8DQ03Zie2YdQllGd6U/noOuqhYcxAqJlC7yiYw9bBx\nLTrCHyukGSpY+f026bNOstId+m8yjdXmpxbAAaYDj8I4UGu1pvBMEWIXBdy9ySZR\nG5g3BoZsntb9OMQQLAEHRNmD7G5XOrQn4cWk6ffESNHDKxLys0S4cVDkWdMgSYHJ\nRc0XvpXbTIWAMdgZamdHl0uFC0rEdmpJLZ7sX0QydleOCFOIe6rQ8gVE5mDoE9dh\nSxKu9lyTAgMBAAECggEAHIfKR5jwxT2D8759riFd8tVR51GGBw2iOk8GOtb8DPyg\n6ZhQVfy+nxnsdSnQb2gHbakrn9CeO2HDZER1xYwshINvLDojhdC0gj0g9zq9p7BU\ndFOpFQeGrnxbOggbsJfQc7QvfDU3iCnSSM54+HYUV1qWaE/DX9+XfSKp0PswivAj\n/UsSW/9Amw6sGTRnmfo5Of1ZPymRl+dvPXM8eZHueJAX2gtkUY82kQlYiPGij0Gn\nZ6a2b3Chalkk1qn7tshPbYlQFzMLHmQG9kaGRNKG8h8ZH6GNZimb0j3EbWWwjhVi\nXPfdEUWapDBenGwW29RW1cgvxQSIZTVW5HpR0S8ESQKBgQDKHJXt4b6wPWs7uuPH\nUk8tj1EYXLfOxHZr+45ChBfckskFfVWkVbvr/l92se/mRa9yE5EGTU9YBE8+QIWk\njDhmhp50Thk0oS0UgTQ4fllB2jUyaw1INVrd/eddH7ulHImfPMP6Fna2JsyaJLnN\nL/E4w7obYtFMkLmzbF/CtgW4DQKBgQDFrKSkqwgJs/QKOJyCPDOwRYKTF3g9FBMC\nBgNpS/oCMY6HVMjQLep98TOkSHa4NgjXFmKxqfkXYpakanZfZ9NYSjWLD2w5A7vh\n6xxx2Um6Cjw95GPO6KISmLDAEXbAAasZ19K/iqkIOjjMHc00Z47E01AcXo+cf5Ie\nyi4p+ImfHwKBgH/6Hc2lNfOu0Gnf6z9ZFR3KNBVzEEhzCnFRtkDUF6/pmjRJqqMG\nTpoeViB4h2mOEovva9NLvMQE5pCKlpUc3NG+yDLpCPjUXhEvxvtGtgoGu8yTELP6\nZPFQRuImp9DjAxm7hnSjKMQqSUAJpUUR6HKDLSMOLW2H7q54HyLR00k5AoGBAK99\nc7WU+U/T6MXiOGAOnjzRmPiJD3/6AF39hK3Ie63S3RwcEyNugA1LQ3OHuY4Uuohp\nITllEvTF28MfmPNeM2zghORtzsBXJkeM+PXB2AhH6e9wgYNBWBF2aQQ6/Ne9I2+Q\nAVN3AFWDisT7eCAcB82JZEerU4e2Ybzf9VfhhBw1AoGAGzkdUW0e99hj99qhAV2X\nsn775de4WsA2VJjpv4TeIPuQWeXuDZjEDbhsoKveHthVqjqUBp46KBDtoGJUxIP9\nI6fQ3BfgPZFPkIqiFnr+KzoZ8p4ZrQ8yCMUlBzgCDAyusL84PENAfTgLDY2GyfQA\nhOoN8UJYQumPfjR/wNlW1uc=\n-----END PRIVATE KEY-----\n-----BEGIN CERTIFICATE-----\nMIIFJzCCBA+gAwIBAgISA3Nz1i0mMMTUigRcyeUyXfaMMA0GCSqGSIb3DQEBCwUA\nMEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQD\nExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0xNzA1MDQxMTI3MDBaFw0x\nNzA4MDIxMTI3MDBaMCAxHjAcBgNVBAMTFXd3dy5kb2NrZXJtZWV0dXAubGl2ZTCC\nASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAJwQTJEb70t0HQAzp0v7jqw/\nF3QTWDzCz3lUAX4oBLM+Btee8uiKYwMcIZHWMn7NfAeel9srDkttDZyN1gj5GYxn\nEYkDTnsJePrMzwNDTdmJ7Zh1CWUZ3pT+eg66qFhzEComULvKJjD1sHEtOsIfK6QZ\nKlj5/Tbps06y0h36bzKN1eanFsABpgOPwjhQa7Wm8EwRYhcF3L3JJlEbmDcGhmye\n1v04xBAsAQdE2YPsblc6tCfhxaTp98RI0cMrEvKzRLhxUORZ0yBJgclFzRe+ldtM\nhYAx2BlqZ0eXS4ULSsR2akktnuxfRDJ2V44IU4h7qtDyBUTmYOgT12FLEq72XJMC\nAwEAAaOCAi8wggIrMA4GA1UdDwEB/wQEAwIFoDAdBgNVHSUEFjAUBggrBgEFBQcD\nAQYIKwYBBQUHAwIwDAYDVR0TAQH/BAIwADAdBgNVHQ4EFgQU/5bULrziWpNDOkIM\n0NJw6MI0qNMwHwYDVR0jBBgwFoAUqEpqYwR93brm0Tm3pkVl7/Oo7KEwcAYIKwYB\nBQUHAQEEZDBiMC8GCCsGAQUFBzABhiNodHRwOi8vb2NzcC5pbnQteDMubGV0c2Vu\nY3J5cHQub3JnLzAvBggrBgEFBQcwAoYjaHR0cDovL2NlcnQuaW50LXgzLmxldHNl\nbmNyeXB0Lm9yZy8wOQYDVR0RBDIwMIIXY2VydHMuZG9ja2VybWVldHVwLmxpdmWC\nFXd3dy5kb2NrZXJtZWV0dXAubGl2ZTCB/gYDVR0gBIH2MIHzMAgGBmeBDAECATCB\n5gYLKwYBBAGC3xMBAQEwgdYwJgYIKwYBBQUHAgEWGmh0dHA6Ly9jcHMubGV0c2Vu\nY3J5cHQub3JnMIGrBggrBgEFBQcCAjCBngyBm1RoaXMgQ2VydGlmaWNhdGUgbWF5\nIG9ubHkgYmUgcmVsaWVkIHVwb24gYnkgUmVseWluZyBQYXJ0aWVzIGFuZCBvbmx5\nIGluIGFjY29yZGFuY2Ugd2l0aCB0aGUgQ2VydGlmaWNhdGUgUG9saWN5IGZvdW5k\nIGF0IGh0dHBzOi8vbGV0c2VuY3J5cHQub3JnL3JlcG9zaXRvcnkvMA0GCSqGSIb3\nDQEBCwUAA4IBAQAwr/madWIGINGuww4oef3mzD+arS3tFBrNJ/tekk4umue0SkkJ\n5I4gO4FhSz9n9GMUZ8M5pfjtXBYaSqnMpz1v1WmTKJXgBKR0+DqVAVl9KsAqWwms\nJ4Rov3VExVQsErjcT4M5RdWC9n17lU0rava5oB8tJc8zwOoPCdOInWj5YKLR0/nD\ngU8madGbOuoviTyY6+k2Pf8H98cDBYfEifjL+TtRfXXoznSkmwwt0as96ys+t2jv\nK0nkPTway7FgKf5gXR81Fr+55TmzxLDfnhZG1ZE7v18UDaZ0CNdj8HQJS+vtg6Hh\npNe3Nr9PNh9vR/iRXsPBbMMyr98rmv7HTkKJ\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIIEkjCCA3qgAwIBAgIQCgFBQgAAAVOFc2oLheynCDANBgkqhkiG9w0BAQsFADA/\nMSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMT\nDkRTVCBSb290IENBIFgzMB4XDTE2MDMxNzE2NDA0NloXDTIxMDMxNzE2NDA0Nlow\nSjELMAkGA1UEBhMCVVMxFjAUBgNVBAoTDUxldCdzIEVuY3J5cHQxIzAhBgNVBAMT\nGkxldCdzIEVuY3J5cHQgQXV0aG9yaXR5IFgzMIIBIjANBgkqhkiG9w0BAQEFAAOC\nAQ8AMIIBCgKCAQEAnNMM8FrlLke3cl03g7NoYzDq1zUmGSXhvb418XCSL7e4S0EF\nq6meNQhY7LEqxGiHC6PjdeTm86dicbp5gWAf15Gan/PQeGdxyGkOlZHP/uaZ6WA8\nSMx+yk13EiSdRxta67nsHjcAHJyse6cF6s5K671B5TaYucv9bTyWaN8jKkKQDIZ0\nZ8h/pZq4UmEUEz9l6YKHy9v6Dlb2honzhT+Xhq+w3Brvaw2VFn3EK6BlspkENnWA\na6xK8xuQSXgvopZPKiAlKQTGdMDQMc2PMTiVFrqoM7hD8bEfwzB/onkxEz0tNvjj\n/PIzark5McWvxI0NHWQWM6r6hCm21AvA2H3DkwIDAQABo4IBfTCCAXkwEgYDVR0T\nAQH/BAgwBgEB/wIBADAOBgNVHQ8BAf8EBAMCAYYwfwYIKwYBBQUHAQEEczBxMDIG\nCCsGAQUFBzABhiZodHRwOi8vaXNyZy50cnVzdGlkLm9jc3AuaWRlbnRydXN0LmNv\nbTA7BggrBgEFBQcwAoYvaHR0cDovL2FwcHMuaWRlbnRydXN0LmNvbS9yb290cy9k\nc3Ryb290Y2F4My5wN2MwHwYDVR0jBBgwFoAUxKexpHsscfrb4UuQdf/EFWCFiRAw\nVAYDVR0gBE0wSzAIBgZngQwBAgEwPwYLKwYBBAGC3xMBAQEwMDAuBggrBgEFBQcC\nARYiaHR0cDovL2Nwcy5yb290LXgxLmxldHNlbmNyeXB0Lm9yZzA8BgNVHR8ENTAz\nMDGgL6AthitodHRwOi8vY3JsLmlkZW50cnVzdC5jb20vRFNUUk9PVENBWDNDUkwu\nY3JsMB0GA1UdDgQWBBSoSmpjBH3duubRObemRWXv86jsoTANBgkqhkiG9w0BAQsF\nAAOCAQEA3TPXEfNjWDjdGBX7CVW+dla5cEilaUcne8IkCJLxWh9KEik3JHRRHGJo\nuM2VcGfl96S8TihRzZvoroed6ti6WqEBmtzw3Wodatg+VyOeph4EYpr/1wXKtx8/\nwApIvJSwtmVi4MFU5aMqrSDE6ea73Mj2tcMyo5jMd6jmeWUHK8so/joWUoHOUgwu\nX4Po1QYz+3dszkDqMp4fklxBwXRsW10KXzPMTZ+sOPAveyxindmjkW8lGy+QsRlG\nPfZ+G6Z6h7mjem0Y+iWlkYcV4PIWL1iwBi8saCbGS5jN2p8M+X+Q7UNKEkROb3N6\nKOqkqm57TH2H3eDJAkSnh6/DNFu0Qg==\n-----END CERTIFICATE-----\n
  tags:
    - loadbalancer
cert-service:
  image: levino/letsencrypt-cert-service
  environment:
    - VIRTUAL_HOST=*.acme.invalid,*/.well-known/*,certs.dockermeetup.live
    - EXCLUDE_PORTS=443
    - CERT_DOMAINS=www.dockermeetup.live,certs.dockermeetup.live
    - CERT_EMAIL=certs@levinkeller.de
    - CERT_SERVICE_PRIVATE=true
    - CERT_SERVICE_PASSWORD=jsksd8272363hska71
    - CERT_SERVICE_USERNAME=user
    - VIRTUAL_HOST_WEIGHT=5
  tags:
    - loadbalancer
  ports:
    - 8443:443